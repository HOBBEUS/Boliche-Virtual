<!DOCTYPE html>
<html>
  <head>
    <title>Juego de Boliche AR</title>
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script src="https://cdn.rawgit.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    <style> body { margin: 0; overflow: hidden; } </style>
  </head>
  <body>
    <a-scene embedded arjs>
      <!-- Marcador para los pinos de boliche -->
      <a-marker type="pattern" url="mipattern.patt">
        <!-- Pinos de boliche -->
        <a-entity id="pino1" geometry="primitive: cone; height: 0.2; radiusBottom: 0.05" position="0 0.1 0" material="color: white"></a-entity>
        <a-entity id="pino2" geometry="primitive: cone; height: 0.2; radiusBottom: 0.05" position="0.1 0.1 0" material="color: white"></a-entity>
        <a-entity id="pino3" geometry="primitive: cone; height: 0.2; radiusBottom: 0.05" position="-0.1 0.1 0" material="color: white"></a-entity>
        <a-entity id="pino4" geometry="primitive: cone; height: 0.2; radiusBottom: 0.05" position="0 0.1 0.1" material="color: white"></a-entity>
        <a-entity id="pino5" geometry="primitive: cone; height: 0.2; radiusBottom: 0.05" position="0 0.1 -0.1" material="color: white"></a-entity>
        <!-- Bola de boliche -->
        <a-sphere id="bola" position="0 0.05 -0.5" radius="0.1" color="yellow"></a-sphere>
      </a-marker>

      <!-- Cámara -->
      <a-entity camera></a-entity>
    </a-scene>

    <script>
      // Lógica para lanzar la bola
      const bola = document.querySelector('#bola');
      let velocidad = new THREE.Vector3(0, 0, 0);
      let lanzado = false;

      // Función para lanzar la bola al hacer clic
      window.addEventListener('click', () => {
        if (!lanzado) {
          velocidad.set(0, 0, -0.3); // Lanzar hacia adelante
          lanzado = true;
        }
      });

      // Función para chequear si la bola ha tocado los pinos
      function verificarColision() {
        const pinos = ['#pino1', '#pino2', '#pino3', '#pino4', '#pino5'];
        pinos.forEach(id => {
          const pino = document.querySelector(id);
          const distancia = bola.object3D.position.distanceTo(pino.object3D.position);
          if (distancia < 0.2) {
            // Pino caído, mostrar animación de caída
            pino.setAttribute('animation', 'property: rotation; to: 0 360 0; dur: 1000');
            pino.setAttribute('material', 'color: red');
          }
        });
      }

      // Lógica para actualizar la posición de la bola
      function actualizar() {
        if (lanzado) {
          bola.object3D.position.add(velocidad);
          velocidad.multiplyScalar(0.99); // Fricción

          // Verificar colisión con pinos
          verificarColision();

          // Detener la bola cuando se detenga completamente
          if (velocidad.length() < 0.01) {
            lanzado = false;
          }
        }
      }

      // Llamar a la función actualizar en cada frame
      document.querySelector('a-scene').addEventListener('renderstart', function () {
        this.setAttribute('animation', 'property: position; to: 0 0 -1; dur: 1000');
      });

      // Ciclo de animación
      setInterval(actualizar, 1000 / 60);
    </script>
  </body>
</html>
